<!DOCTYPE html>
<html lang='en'>
<head>
	<title>SpringRoll Container v0.5.2 API Documentation : src/container/Container.js</title>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
	<link rel='shortcut icon' type='image/png' href='../assets/images/favicon.ico?v=0.5.2'>
	<link href='//fonts.googleapis.com/css?family=Titillium+Web:300,200,600' rel='stylesheet' type='text/css'>
	<link rel='stylesheet' type='text/css' href='../assets/css/libraries.css?v=0.5.2'>
	<link rel='stylesheet' type='text/css' href='../assets/css/main.css?v=0.5.2'>
</head>
<body>
<header>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class='container'>
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#docs-navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href='https://github.com/SpringRoll/SpringRollContainer'>
						<img src='../assets/images/logo.png?v=0.5.2' class="logo">
					<span class='project-name'>SpringRoll Container</span>
					<span class="sr-only">API Documentation for:</span>
					<span class='version hidden-xs'>v0.5.2</span>
				</a>
			</div>
			<div class="collapse navbar-collapse" id="docs-navbar">
	      <ul class="scope-toggles text-center nav navbar-nav navbar-right">
					<li><input class='scope-toggle' 
						id='toggle-inherited' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Inherited' 
						data-off='Inherited' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-protected' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Protected' 
						data-off='Protected' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-private' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Private' 
						data-off='Private' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-deprecated' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Deprecated' 
						data-off='Deprecated' 
						data-size='mini'
						data-width='80'>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>
<div class='container'>
<div class='row'>
<nav id='sidebar' class='col-sm-4 col-md-3'>
<h2>APIs</h2>
<div class='input-group'>
  <div class='input-group-addon'>
    <span class='glyphicon glyphicon-search'></span>
  </div>
  <input type='search' class='form-control' id='api-filter' placeholder='Type to filter APIs'>
  <span class='collapsed btn-close glyphicon glyphicon-remove-sign hidden'></span>
</div>
<nav class='navbar navbar-default'>
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="btn-group" role="group" aria-label="...">
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-classes' data-target='#classes-collapse'>
      Classes
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-modules' data-target='#modules-collapse'>
      Modules
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='classes-collapse'>
    <ul class='nav navbar-nav'>
        <li class='public'>
          <a href='../classes/springroll.Container.html'>springroll.Container</a>
        </li>
        <li class='public'>
          <a href='../classes/springroll.ContainerPlugin.html'>springroll.ContainerPlugin</a>
        </li>
        <li class='public'>
          <a href='../classes/springroll.Features.html'>springroll.Features</a>
        </li>
        <li class='public'>
          <a href='../classes/springroll.SavedDataHandler.html'>springroll.SavedDataHandler</a>
        </li>
    </ul>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='modules-collapse'>
    <ul class='nav navbar-nav'>
        <li class=''>
          <a href='../modules/Container.html'>Container</a>
        </li>
        <li class=''>
          <a href='../modules/Core.html'>Core</a>
        </li>
    </ul>
  </div>
  <!-- /.container-fluid -->
</nav></nav>
<div class='col-sm-8 col-md-9'>
<div id='docs-main' class='apidocs'>
<h1 class="file-heading">File:Container.js</h1>

<div class="file">
<pre class="code prettyprint linenums">/**
 * @module Container
 * @namespace springroll
 */
(function(document, undefined)
{
	//Import classes
	var EventDispatcher = include(&#x27;springroll.EventDispatcher&#x27;),
		Features = include(&#x27;springroll.Features&#x27;),
		Bellhop = include(&#x27;Bellhop&#x27;),
		$ = include(&#x27;jQuery&#x27;);

	/**
	 * The application container
	 * @class Container
	 * @extends springroll.EventDispatcher
	 * @constructor
	 * @param {string} iframeSelector jQuery selector for application iframe container
	 * @param {object} [options] Optional parameteres
	 * @param {string} [options.helpButton] jQuery selector for help button
	 * @param {string} [options.captionsButton] jQuery selector for captions button
	 * @param {string} [options.soundButton] jQuery selector for captions button
	 * @param {string} [options.voButton] jQuery selector for vo button
	 * @param {string} [options.sfxButton] jQuery selector for sounf effects button
	 * @param {string} [options.musicButton] jQuery selector for music button
	 * @param {string} [options.pauseButton] jQuery selector for pause button
	 * @param {string} [options.pauseFocusSelector=&#x27;.pause-on-focus&#x27;] The class to pause
	 *        the application when focused on. This is useful for form elements which
	 *        require focus and play better with Application&#x27;s keepFocus option.
	 */
	var Container = function(iframeSelector, options)
	{
		EventDispatcher.call(this);

		/**
		 * The options
		 * @property {Object} options
		 * @readOnly
		 */
		this.options = options ||
		{};

		/**
		 * The name of this class
		 * @property {string} name
		 */
		this.name = &#x27;springroll.Container&#x27;;

		/**
		 * The current iframe jquery object
		 * @property {jquery} iframe
		 */
		this.main = $(iframeSelector);

		/**
		 * The DOM object for the iframe
		 * @property {Element} dom
		 */
		this.dom = this.main[0];

		/**
		 * Communication layer between the container and application
		 * @property {Bellhop} client
		 */
		this.client = null;

		/**
		 * The current release data
		 * @property {Object} release
		 */
		this.release = null;

		/**
		 * Check to see if a application is loaded
		 * @property {Boolean} loaded
		 * @readOnly
		 */
		this.loaded = false;

		/**
		 * Check to see if a application is loading
		 * @property {Boolean} loading
		 * @readOnly
		 */
		this.loading = false;

		// Bind close failed handler
		this._onCloseFailed = this._onCloseFailed.bind(this);

		// Setup plugins
		var plugins = Container._plugins;
		for (var i = 0; i &lt; plugins.length; i++)
		{
			plugins[i].setup.call(this);
		}
	};

	/**
	 * The current version of the library
	 * @property {String} version
	 * @static
	 * @readOnly
	 * @default VERSION
	 */
	Container.version = VERSION;

	//Reference to the prototype
	var s = EventDispatcher.prototype;
	var p = EventDispatcher.extend(Container);

	/**
	 * The collection of Container plugins
	 * @property {Array} _plugins
	 * @static
	 * @private
	 */
	Container._plugins = [];

	/**
	 * Open a application or path
	 * @method _internalOpen
	 * @protected
	 * @param {string} path The full path to the application to load
	 * @param {Object} [options] The open options
	 * @param {Boolean} [options.singlePlay=false] If we should play in single play mode
	 * @param {Object} [options.playOptions=null] The optional play options
	 */
	p._internalOpen = function(path, options)
	{
		options = $.extend(
		{
			singlePlay: false,
			playOptions: null
		}, options);

		this.reset();

		// Dispatch event for unsupported browsers
		// and then bail, don&#x27;t continue with loading the application
		var err = Features.basic();
		if (err)
		{
			/**
			 * Fired when the application is unsupported
			 * @event unsupported
			 * @param {String} err The error message
			 */
			return this.trigger(&#x27;unsupported&#x27;, err);
		}

		this.loading = true;

		this.initClient();

		// Open plugins
		var plugins = Container._plugins;
		for (var i = 0; i &lt; plugins.length; i++)
		{
			plugins[i].open.call(this);
		}

		//Open the application in the iframe
		this.main
			.addClass(&#x27;loading&#x27;)
			.prop(&#x27;src&#x27;, path);

		// Respond with data when we&#x27;re ready
		this.client.respond(&#x27;singlePlay&#x27;, options.singlePlay);
		this.client.respond(&#x27;playOptions&#x27;, options.playOptions);

		/**
		 * Event when request to open an application has begin either by
		 * calling &#x60;openPath&#x60; or &#x60;openRemote&#x60;
		 * @event open
		 */
		this.trigger(&#x27;open&#x27;);
	};

	/**
	 * Open a application or path
	 * @method openPath
	 * @param {string} path The full path to the application to load
	 * @param {Object} [options] The open options
	 * @param {Boolean} [options.singlePlay=false] If we should play in single play mode
	 * @param {Object} [options.playOptions=null] The optional play options
	 */
	p.openPath = function(path, options, playOptions)
	{
		options = options ||
		{};

		// This should be deprecated, support for old function signature
		if (typeof options === &quot;boolean&quot;)
		{
			options = {
				singlePlay: singlePlay,
				playOptions: playOptions
			};
		}
		this._internalOpen(path, options);
	};

	/**
	 * Set up communication layer between site and application.
	 * May be called from subclasses if they create/destroy Bellhop instances.
	 * @protected
	 * @method initClient
	 */
	p.initClient = function()
	{
		//Setup communication layer between site and application
		this.client = new Bellhop();
		this.client.connect(this.dom);

		//Handle bellhop events coming from the application
		this.client.on(
		{
			loading: onLoading.bind(this),
			loadDone: onLoadDone.bind(this), // @deprecated use &#x27;loaded&#x27; instead
			loaded: onLoadDone.bind(this),
			endGame: onEndGame.bind(this),
			localError: onLocalError.bind(this)
		});
	};

	/**
	 * Removes the Bellhop communication layer altogether.
	 * @protected
	 * @method destroyClient
	 */
	p.destroyClient = function()
	{
		if (this.client)
		{
			this.client.destroy();
			this.client = null;
		}
	};

	/**
	 * Handle the local errors
	 * @method onLocalError
	 * @private
	 * @param  {Event} event Bellhop event
	 */
	var onLocalError = function(event)
	{
		this.trigger(event.type, event.data);
	};

	/**
	 * The game is starting to load
	 * @method onLoading
	 * @private
	 */
	var onLoading = function()
	{
		/**
		 * Event when a application start loading, first even received
		 * from the Application.
		 * @event opening
		 */
		this.trigger(&#x27;opening&#x27;);
	};

	/**
	 * Reset the mutes for audio and captions
	 * @method onLoadDone
	 * @private
	 */
	var onLoadDone = function()
	{
		this.loading = false;
		this.loaded = true;
		this.main.removeClass(&#x27;loading&#x27;);

		var plugins = Container._plugins;
		for (var i = 0; i &lt; plugins.length; i++)
		{
			plugins[i].opened.call(this);
		}

		/**
		 * Event when the application gives the load done signal
		 * @event opened
		 */
		this.trigger(&#x27;opened&#x27;);
	};

	/**
	 * The application ended and destroyed itself
	 * @method onEndGame
	 * @private
	 */
	var onEndGame = function()
	{
		this.reset();
	};

	/**
	 * Reset all the buttons back to their original setting
	 * and clear the iframe.
	 * @method reset
	 */
	p.reset = function()
	{
		var wasLoaded = this.loaded || this.loading;

		// Destroy in the reverse priority order
		if (wasLoaded)
		{
			var plugins = Container._plugins;
			for (var i = plugins.length - 1; i &gt;= 0; i--)
			{
				plugins[i].closed.call(this);
			}
		}

		// Remove bellhop instance
		this.destroyClient();

		// Reset state
		this.loaded = false;
		this.loading = false;

		// Clear the iframe src location
		this.main.attr(&#x27;src&#x27;, &#x27;&#x27;)
			.removeClass(&#x27;loading&#x27;);

		if (wasLoaded)
		{
			this.off(&#x27;localError&#x27;, this._onCloseFailed);

			/**
			 * Event when a application closes
			 * @event closed
			 */
			this.trigger(&#x27;closed&#x27;);
		}
	};

	/**
	 * Tell the application to start closing
	 * @method close
	 */
	p.close = function()
	{
		if (this.loading || this.loaded)
		{
			var plugins = Container._plugins;
			for (var i = plugins.length - 1; i &gt;= 0; i--)
			{
				plugins[i].close.call(this);
			}

			/**
			 * Event when a application starts closing
			 * @event close
			 */
			this.trigger(&#x27;close&#x27;);

			/**
			 * There was an uncaught iframe error destroying the game on closing
			 * @event localError
			 * @param {Error} error The error triggered
			 */
			this.once(&#x27;localError&#x27;, this._onCloseFailed);

			// Start the close
			this.client.send(&#x27;close&#x27;);
		}
		else
		{
			this.reset();
		}
	};

	/**
	 * If there was an error when closing, reset the container
	 * @method _onCloseFailed
	 * @private
	 */
	p._onCloseFailed = function()
	{
		this.reset(); // force close the app
	};

	/**
	 * Destroy and don&#x27;t use after this
	 * @method destroy
	 */
	p.destroy = function()
	{
		this.reset();

		s.destroy.call(this);

		// Destroy in the reverse priority order
		var plugins = Container._plugins;
		for (var i = plugins.length - 1; i &gt;= 0; i--)
		{
			plugins[i].teardown.call(this);
		}

		this.main = null;
		this.options = null;
		this.dom = null;
	};

	namespace(&#x27;springroll&#x27;).Container = Container;

}(document));</pre>
</div></div>
</div>
</div>
</div>
<script src='../assets/js/libraries.js?v=0.5.2'></script>
<script src='../assets/js/main.js?v=0.5.2'></script>
</body>
</html>