<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible"
    content="ie=edge" />
  <title>iFrame</title>
  <style>
    #number-reports {
      display: flex;
      flex-direction: row;

    }

    .columnGroup {
      display: flex;
      flex-direction: column;
    }

    .hud-position {
      position: relative;
      width: 50px;
      border: 1px solid black;
    }

    .hud-position.--top {
      top: 0;
      left: 0;
    }

    .hud-position.--bottom {
      top: 100%;
      left: 0;
    }

    #button-size.--sm {
      width: 100px;
      height: 25px;
    }

    #button-size.--md {
      width: 150px;
      height: 37.5px;
    }

    #button-size.--lg {
      width: 200px;
      height: 50px;
    }

    .distracting-cb {
      height: 60px;
      width: 60px;
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .cb__distracting {
      position: absolute;
      color: white;
    }

    #layer1 {
      height: 60%;
      width: 60%;
      background-color: red;
      z-index: 3;
    }

    #layer2 {
      height: 80%;
      width: 80%;
      background-color: blue;
      z-index: 2;
    }

    #layer3 {
      height: 100%;
      width: 100%;
      background-color: green;
      z-index: 1;
    }
  </style>
</head>

<body>

  <div class="hud-position --top">HUD</div>

  <div class='distracting-cb'>
    <div id="layer1"
      class="cb__distracting">1</div>
    <div id="layer2"
      class="cb__distracting">2</div>
    <div id="layer3"
      class="cb__distracting">3</div>
  </div>

  <form id="number-reports">
    <div class="columnGroup">
      <label for="pointer-size">Pointer Size: </label>
      <input id="pointer-size"
        type="number"
        name="pointer-size">

      <label for="control-sensitivity">Control Sensitivity: </label>
      <input id="control-sensitivity"
        type="number"
        name="pointer-size">

      <label for="colorBlind">Color Filter: </label>
      <input id="colorBlind"
        type="text"
        name="colorBlind">

      <input id="button-size"
        class="--sm"
        type="submit"
        value="UI/Button Size">
    </div>

    <!--Difficulty Number Reports-->

    <div class="columnGroup">
      <label for="hitAreaScale">Hit Area Scale: </label>
      <input id="hitAreaScale"
        type="number"
        name="hitAreaScale">

      <label for="dragThresholdScale">Drag Threshold Scale: </label>
      <input id="dragThresholdScale"
        type="number"
        name="dragThresholdScale">

      <label for="health">Health: </label>
      <input id="health"
        type="number"
        name="health">

      <label for="objectCount">Object Count: </label>
      <input id="objectCount"
        type="number"
        name="objectCount">

      <label for="completionPercentage">Completion Percentage: </label>
      <input id="completionPercentage"
        type="number"
        name="completionPercentage">

      <label for="speedScale">Speed Scale: </label>
      <input id="speedScale"
        type="number"
        name="speedScale">

      <label for="timersScale">Timers Scale: </label>
      <input id="timersScale"
        type="number"
        name="timersScale">

      <label for="inputCount">Input Count: </label>
      <input id="inputCount"
        type="number"
        name="inputCount">
    </div>
    <!--End Difficulty Number Reports-->

  </form>

  <script src="dist/SpringRoll-umd.js"></script>
  <script type="module">

    // import UserData from './node_modules/springroll/src/state/UserData.js'
    const buttonSize = document.querySelector('#button-size');
    const distractingLayersCB = document.querySelectorAll('.cb__distracting');


    const testApp = new springroll.Application({
      features: {
        captions: true,
        pointerSize: true,
        controlSensitivity: true,
        buttonSize: true,
        removableLayers: true,
        hudPosition: true,
        keyBinding: true,
        colorVision: true,
        soundVolume: true,
        voVolume: true,
        musicVolume: true,
        sfxVolume: true,
        //Difficulty Features
        hitAreaScale: true,
        dragThresholdScale: true,
        health: true,
        objectCount: true,
        completionPercentage: true,
        speedScale: true,
        timersScale: true,
        inputCount: true,
        indexedDBPlugin: true
      }
    });

    //Reminder of how to use the COLOR_VISION enum
    const test = springroll.COLOR_VISION.ACHROMATOPSIA;
    console.log(test);

    console.log(testApp);

    testApp.state.pointerSize.subscribe(result => {
      document.querySelector('#pointer-size').value = "" + result;
    });
    testApp.state.controlSensitivity.subscribe(result => {
      document.querySelector('#control-sensitivity').value = "" + result;
    });

    testApp.state.buttonSize.subscribe(result => {
      if (result < 0.33) {
        buttonSize.classList.remove('--md');
        buttonSize.classList.remove('--lg');
        buttonSize.classList.add('--sm');
      } else if (result >= 0.33 && result < 0.66) {
        buttonSize.classList.add('--md');
        buttonSize.classList.remove('--lg');
        buttonSize.classList.remove('--sm');
      } else {
        buttonSize.classList.remove('--md');
        buttonSize.classList.add('--lg');
        buttonSize.classList.remove('--sm');
      }
    });

    testApp.state.removableLayers.subscribe(result => {
      if (result >= 0.25 && result <= 0.5) {
        document.querySelector('#layer1').style.display = 'none';
        document.querySelector('#layer2').style.display = 'block';
        document.querySelector('#layer3').style.display = 'block';
      } else if (result > 0.5 && result <= 0.75) {
        document.querySelector('#layer1').style.display = 'none';
        document.querySelector('#layer2').style.display = 'none';
        document.querySelector('#layer3').style.display = 'block';
      } else if (result > 0.75) {
        document.querySelector('#layer1').style.display = 'none';
        document.querySelector('#layer2').style.display = 'none';
        document.querySelector('#layer3').style.display = 'none';
      } else {
        document.querySelector('#layer1').style.display = 'block';
        document.querySelector('#layer2').style.display = 'block';
        document.querySelector('#layer3').style.display = 'block';
      }
    });

    testApp.container.respond('hudPositions', ['top', 'bottom']);
    testApp.container.respond('keyBindings', [
      { actionName: 'Up', defaultKey: 'w' },
      { actionName: 'Down', defaultKey: 's' },
    ]);
    testApp.container.respond('colorFilters', [
      springroll.COLOR_VISION.ACHROMATOPSIA,
      springroll.COLOR_VISION.TRITANOPIA,
      springroll.COLOR_VISION.DEUTERANOPIA,
    ]);

    testApp.state.keyBinding.subscribe(result => {
      console.log('keyBinding: ', result);
    });

    testApp.state.colorVision.subscribe(result => {
      console.log('colorVision: ', result);
      document.querySelector('#colorBlind').value = "" + result;
    });

    testApp.state.hudPosition.subscribe(result => {
      console.log('hudPosition: ', result);
      switch (result) {
        case 'top':
          document.querySelector('.hud-position').classList.remove('--bottom');
          document.querySelector('.hud-position').classList.add('--top');
          break;
        case 'bottom':
          document.querySelector('.hud-position').classList.remove('--top');
          document.querySelector('.hud-position').classList.add('--bottom');
      }
    });

    testApp.state.soundVolume.subscribe(result => {
      console.log('soundVolume: ', result);
    });
    testApp.state.musicVolume.subscribe(result => {
      console.log('musicVolume: ', result);
    });
    testApp.state.sfxVolume.subscribe(result => {
      console.log('sfxVolume: ', result);
    });
    testApp.state.voVolume.subscribe(result => {
      console.log('voVolume: ', result);
    });

    testApp.state.captionsMuted.subscribe(result => {
      console.log('captionsMuted: ', result);
    });

    testApp.state.hitAreaScale.subscribe(result => {
      console.log('hitAreaScale: ', result);
      document.querySelector('#hitAreaScale').value = "" + result;
    });
    testApp.state.dragThresholdScale.subscribe(result => {
      console.log('dragThresholdScale: ', result);
      document.querySelector('#dragThresholdScale').value = "" + result;
    });
    testApp.state.health.subscribe(result => {
      console.log('health: ', result);
      document.querySelector('#health').value = "" + result;
    });
    testApp.state.objectCount.subscribe(result => {
      console.log('objectCount: ', result);
      document.querySelector('#objectCount').value = "" + result;
    });
    testApp.state.completionPercentage.subscribe(result => {
      console.log('completionPercentage: ', result);
      document.querySelector('#completionPercentage').value = "" + result;
    });
    testApp.state.speedScale.subscribe(result => {
      console.log('speedScale: ', result);
      document.querySelector('#speedScale').value = "" + result;
    });
    testApp.state.timersScale.subscribe(result => {
      console.log('timersScale: ', result);
      document.querySelector('#timersScale').value = "" + result;
    });
    testApp.state.inputCount.subscribe(result => {
      console.log('inputCount: ', result);
      document.querySelector('#inputCount').value = "" + result;
    });

    // testApp.container.on('connected', async () => {
    //   console.log('insideCallback');

    //   await springroll.UserData.write('goblle', {foo:'bar'})
      
    //   // const userData = new springroll.UserData('dbName');
    //   // await springroll.UserData.IDBOpen('asdf', 1);
    // });


    testApp.container.on('connected', async () => {
        await springroll.UserData.write('my-value', { foo:'bar' });

        const value = await springroll.UserData.read('my-value');
        console.log('Value retrieved:', value);

        await springroll.UserData.delete('my-value');
    });


  </script>
</body>

</html>